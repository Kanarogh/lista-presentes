<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lista de Presentes - Chá de Casa Nova</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }

    .gradient-bg {
      background: linear-gradient(135deg, #f8fffe 0%, #f0fdf4 100%);
    }

    .gold-accent {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
    }

    .item-card {
      transition: all 0.3s ease;
      border: 1px solid #e5e7eb;
    }

    .item-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    .buy-button {
      transition: all 0.2s ease;
    }

    .buy-button:hover {
      transform: scale(1.05);
    }

    .edit-button {
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .item-card:hover .edit-button {
      opacity: 1;
    }

    .mode-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 100;
    }

    .admin-only {
      display: block;
    }

    .user-mode .admin-only {
      display: none;
    }
  </style>
</head>

<body class="gradient-bg min-h-full" id="mainBody">
  <!-- Mode Toggle -->
  <div class="mode-toggle">
    <button onclick="toggleMode()" id="modeToggle"
      class="bg-white shadow-lg rounded-full px-4 py-2 text-sm font-medium border border-gray-200 hover:shadow-xl transition-all">
      👤 Modo Usuário
    </button>
  </div>

  <main class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- Header -->
    <header class="text-center mb-12">
      <h1 class="text-4xl font-bold text-green-800 mb-4">🏠 Lista de Presentes</h1>
      <h2 class="text-2xl text-green-600 mb-2">Chá de Casa Nova</h2>
      <p class="text-gray-600 max-w-2xl mx-auto">Escolha um presente especial para nossa nova casa! Clique em "Comprar"
        para ser direcionado à loja ou anote o nome do produto para comprar onde preferir.</p>

      <!-- Mode Indicator -->
      <div id="modeIndicator"
        class="mt-4 inline-flex items-center px-4 py-2 bg-green-100 text-green-800 rounded-full text-sm font-medium">
        🔧 Modo Administrador - Você pode editar a lista
      </div>
    </header>

    <!-- Admin Controls -->
    <div class="admin-only text-center mb-8">
      <button onclick="showAddForm()"
        class="gold-accent text-white px-6 py-3 rounded-full font-semibold shadow-lg hover:shadow-xl transition-all duration-300">
        ✨ Adicionar Presente
      </button>
    </div>

    <!-- Add Item Form (Hidden by default) -->
    <div id="addForm" class="admin-only hidden bg-white rounded-2xl shadow-lg p-6 mb-8 border border-green-100">
      <h3 class="text-xl font-semibold text-green-800 mb-4">Adicionar Novo Presente</h3>
      <form onsubmit="addItem(event)" class="space-y-4">
        <div>
          <label for="itemName" class="block text-sm font-medium text-gray-700 mb-1">Nome do Produto</label>
          <input type="text" id="itemName" required
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
        </div>
        <div>
          <label for="itemLink" class="block text-sm font-medium text-gray-700 mb-1">Link de Compra</label>
          <input type="url" id="itemLink" required
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
            placeholder="https://...">
        </div>
        <div>
          <label for="itemCategory" class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
          <select id="itemCategory"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
            <option value="Cozinha">🍳 Cozinha</option>
            <option value="Sala">🛋 Sala</option>
            <option value="Quarto">🛏 Quarto</option>
            <option value="Banheiro">🚿 Banheiro</option>
            <option value="Decoração">🎨 Decoração</option>
            <option value="Limpeza">🧽 Limpeza</option>
            <option value="Outros">📦 Outros</option>
          </select>
        </div>
        <div class="flex gap-3">
          <button type="submit"
            class="flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
            Adicionar
          </button>
          <button type="button" onclick="hideAddForm()"
            class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">
            Cancelar
          </button>
        </div>
      </form>
    </div>

    <!-- Gift List -->
    <div id="giftList" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      <!-- Items will be loaded here -->
    </div>

    <!-- Edit Modal (Hidden by default) -->
    <div id="editModal"
      class="admin-only hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md">
        <h3 class="text-xl font-semibold text-green-800 mb-4">Editar Presente</h3>
        <form onsubmit="updateItem(event)" class="space-y-4">
          <input type="hidden" id="editItemId">
          <div>
            <label for="editItemName" class="block text-sm font-medium text-gray-700 mb-1">Nome do Produto</label>
            <input type="text" id="editItemName" required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
          </div>
          <div>
            <label for="editItemLink" class="block text-sm font-medium text-gray-700 mb-1">Link de Compra</label>
            <input type="url" id="editItemLink" required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
          </div>
          <div>
            <label for="editItemCategory" class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
            <select id="editItemCategory"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
              <option value="Cozinha">🍳 Cozinha</option>
              <option value="Sala">🛋 Sala</option>
              <option value="Quarto">🛏 Quarto</option>
              <option value="Banheiro">🚿 Banheiro</option>
              <option value="Decoração">🎨 Decoração</option>
              <option value="Limpeza">🧽 Limpeza</option>
              <option value="Outros">📦 Outros</option>
            </select>
          </div>
          <div class="flex gap-3">
            <button type="submit"
              class="flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
              Salvar
            </button>
            <button type="button" onclick="hideEditModal()"
              class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>
  </main>

 <script type="module">
    // Importa as funções que vamos usar
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
    import { getFirestore, collection, getDocs, addDoc, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

    // --- COLE A SUA MESMA CONFIGURAÇÃO DO FIREBASE AQUI ---
    const firebaseConfig = {
        apiKey: "AIzaSyDHzO4EEriWRsbIwW6Dry0pQAww4e4d3-c",
        authDomain: "lista-de-presentes-e3c02.firebaseapp.com",
        projectId: "lista-de-presentes-e3c02",
        storageBucket: "lista-de-presentes-e3c02.appspot.com",
        messagingSenderId: "89325375943",
        appId: "1:89325375943:web:4cca547dbfcdbc0f5909e2",
        measurementId: "G-N421XQHTF8"
    };

    // Inicializa Firebase e os serviços que vamos usar
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- CONFIGURAÇÃO ---
    const ADMIN_EMAIL = "admin@gmail.com"; // <-- MUDE PARA O SEU EMAIL DE ADMIN

    let gifts = [];
    let isAdminMode = false;

    // Elementos da página
    const body = document.getElementById('mainBody');
    const modeToggle = document.getElementById('modeToggle');
    const modeIndicator = document.getElementById('modeIndicator');

    // Função de logout atualizada
    function logout() {
        signOut(auth).then(() => {
            console.log('Usuário deslogado');
        }).catch((error) => {
            console.error('Erro ao deslogar:', error);
        });
    }

    // Listener de Autenticação (verifica se o usuário está logado)
    onAuthStateChanged(auth, user => {
        if (user && user.email === ADMIN_EMAIL) {
            isAdminMode = true;
            body.classList.remove('user-mode');
            modeIndicator.innerHTML = '🔧 Modo Administrador - Você pode editar a lista';
            modeIndicator.className = 'mt-4 inline-flex items-center px-4 py-2 bg-green-100 text-green-800 rounded-full text-sm font-medium';
            modeToggle.innerHTML = '🚪 Sair';
            modeToggle.onclick = logout;
        } else {
            isAdminMode = false;
            body.classList.add('user-mode');
            modeIndicator.innerHTML = '👁 Modo Visualização - Lista somente leitura';
            modeIndicator.className = 'mt-4 inline-flex items-center px-4 py-2 bg-blue-100 text-blue-800 rounded-full text-sm font-medium';
            modeToggle.innerHTML = '👤 Login Admin';
            modeToggle.onclick = () => { window.location.href = 'login.html'; };
        }
        fetchGifts();
    });

    // --- FUNÇÕES DE DADOS COM FIREBASE V9+ ---

    async function fetchGifts() {
        const giftList = document.getElementById('giftList');
        giftList.innerHTML = 'Carregando presentes...';

        try {
            const giftsCollection = collection(db, 'gifts');
            const snapshot = await getDocs(giftsCollection);
            gifts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderGifts();
        } catch (error) {
            console.error("Erro ao buscar presentes: ", error);
            giftList.innerHTML = '<p class="text-red-500 col-span-3 text-center">Não foi possível carregar a lista.</p>';
        }
    }

    window.addItem = async function(event) {
        event.preventDefault();
        if (!isAdminMode) return;

        const name = document.getElementById('itemName').value;
        const link = document.getElementById('itemLink').value;
        const category = document.getElementById('itemCategory').value;

        try {
            await addDoc(collection(db, 'gifts'), { name, link, category });
            hideAddForm();
            fetchGifts();
        } catch (error) {
            console.error("Erro ao adicionar item: ", error);
        }
    }

    window.updateItem = async function(event) {
        event.preventDefault();
        if (!isAdminMode) return;

        const id = document.getElementById('editItemId').value;
        const name = document.getElementById('editItemName').value;
        const link = document.getElementById('editItemLink').value;
        const category = document.getElementById('editItemCategory').value;

        try {
            const giftDoc = doc(db, 'gifts', id);
            await updateDoc(giftDoc, { name, link, category });
            hideEditModal();
            fetchGifts();
        } catch (error) {
            console.error("Erro ao atualizar item: ", error);
        }
    }

    window.deleteItem = async function(id) {
        if (!isAdminMode) return;
        if (confirm("Tem certeza que deseja excluir este presente?")) {
            try {
                await deleteDoc(doc(db, 'gifts', id));
                fetchGifts();
            } catch (error) {
                console.error("Erro ao deletar item: ", error);
            }
        }
    }

    // --- FUNÇÕES DE INTERFACE (praticamente sem alterações) ---

    function renderGifts() {
        const giftList = document.getElementById('giftList');
        giftList.innerHTML = '';

        if (gifts.length === 0) {
            giftList.innerHTML = '<p class="text-gray-500 col-span-3 text-center">Nenhum presente na lista ainda.</p>';
            return;
        }

        gifts.forEach(gift => {
            const giftCard = document.createElement('div');
            giftCard.className = 'item-card bg-white rounded-2xl p-6 shadow-md relative';

            giftCard.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <span class="text-sm font-medium text-green-600 bg-green-50 px-3 py-1 rounded-full">
                        ${gift.category}
                    </span>
                    ${isAdminMode ? `<button onclick="editItem('${gift.id}')" class="edit-button text-gray-400 hover:text-green-600 p-1">✏</button>` : ''}
                </div>
                <h3 class="text-lg font-semibold text-gray-800 mb-4 leading-tight">${gift.name}</h3>
                <div class="flex gap-2 items-center">
                    <button onclick="buyItem('${gift.link}')" class="buy-button flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 font-medium">🛒 Comprar</button>
                    ${isAdminMode ? `<button onclick="deleteItem('${gift.id}')" class="text-red-400 hover:text-red-600 p-2">🗑</button>` : ''}
                </div>
            `;
            giftList.appendChild(giftCard);
        });
    }

    window.showAddForm = function() {
        if (!isAdminMode) return;
        document.getElementById('addForm').classList.remove('hidden');
    }

    window.hideAddForm = function() {
        document.getElementById('addForm').classList.add('hidden');
        document.getElementById('addForm').querySelector('form').reset();
    }

    window.editItem = function(id) {
        if (!isAdminMode) return;
        const gift = gifts.find(g => g.id === id);
        if (gift) {
            document.getElementById('editItemId').value = id;
            document.getElementById('editItemName').value = gift.name;
            document.getElementById('editItemLink').value = gift.link;
            document.getElementById('editItemCategory').value = gift.category;
            document.getElementById('editModal').classList.remove('hidden');
        }
    }

    window.hideEditModal = function() {
        document.getElementById('editModal').classList.add('hidden');
    }

    window.buyItem = function(link) {
        window.open(link, '_blank', 'noopener,noreferrer');
    }

    // Anexa as funções ao objeto window para que possam ser chamadas pelo HTML (onclick)
    // Isso é necessário quando usamos script type="module"
    window.logout = logout;

</script>

</body>

</html>
